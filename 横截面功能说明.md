# 横截面观测功能实现说明

## 功能概述

已实现完整的横截面观测功能，模拟医学影像（CT/MRI）的观察方式。功能采用组件化设计，便于扩展和维护。

## 组件结构

### 1. 核心工具类
**文件**: `src/utils/crossSection.js`

提供横截面计算的核心逻辑：
- `createSectionPlane()` - 创建截面平面
- `applySectionToModel()` - 应用截面到模型
- `removeSectionFromModel()` - 移除截面效果
- `getSectionTypeName()` - 获取截面类型名称
- `getSectionTypeDescription()` - 获取截面类型描述

### 2. 横截面控制器
**文件**: `src/components/Scene/CrossSectionController.vue`

逻辑组件，负责在 3D 场景中应用横截面效果：
- 监听状态变化，自动更新截面
- 提供 `setModelRef()` 方法设置模型引用
- 提供 `clearSection()` 方法清除截面

### 3. 横截面控制面板
**文件**: `src/components/UI/CrossSectionPanel.vue`

UI 组件，提供用户交互界面：
- 截面类型选择（冠状面/矢状面/横断面）
- 截面位置控制（滑块 + 数值输入）
- 截面厚度控制
- 扫描动画播放
- 三视图模式切换
- 重置功能

### 4. 三视图模式组件
**文件**: `src/components/Scene/ThreeViewMode.vue`

同时显示三个方向的截面视图：
- 冠状面视图
- 矢状面视图
- 横断面视图
- 实时同步截面位置

### 5. 扫描动画 Composable
**文件**: `src/composables/useSectionAnimation.js`

提供截面扫描动画功能：
- `playScanAnimation()` - 播放扫描动画
- `stopAnimation()` - 停止动画
- `pauseAnimation()` - 暂停动画

## 使用方法

### 基础使用

在页面中引入组件：

```vue
<template>
  <div>
    <!-- 3D 场景 -->
    <div ref="canvasContainer"></div>
    
    <!-- 横截面控制器 -->
    <CrossSectionController ref="sectionController" />
    
    <!-- 控制面板 -->
    <CrossSectionPanel />
    
    <!-- 三视图模式 -->
    <ThreeViewMode 
      :enabled="threeViewMode"
      :model="modelRef"
      :main-scene="scene"
    />
  </div>
</template>

<script setup>
import CrossSectionController from '@/components/Scene/CrossSectionController.vue'
import CrossSectionPanel from '@/components/UI/CrossSectionPanel.vue'
import ThreeViewMode from '@/components/Scene/ThreeViewMode.vue'
</script>
```

### 设置模型引用

模型加载后，需要设置模型引用：

```javascript
// 方式1：通过 ref 设置
sectionControllerRef.value.setModelRef(model)

// 方式2：设置到全局（自动识别）
window.modelRef = model
```

## 状态管理

横截面相关状态存储在 `sceneStore` 中：

```javascript
import { useSceneStore } from '@/stores/sceneStore'

const sceneStore = useSceneStore()

// 截面类型
sceneStore.crossSectionType // 'coronal' | 'sagittal' | 'axial'

// 截面位置 (0-1)
sceneStore.crossSectionPosition

// 截面厚度
sceneStore.crossSectionThickness

// 三视图模式
sceneStore.threeViewMode

// 方法
sceneStore.setCrossSectionType(type)
sceneStore.setCrossSectionPosition(position)
sceneStore.setCrossSectionThickness(thickness)
sceneStore.setThreeViewMode(enabled)
```

## 扩展指南

### 添加新的截面类型

1. 在 `src/utils/crossSection.js` 中添加新的类型：

```javascript
export const SectionType = {
  // ... 现有类型
  OBLIQUE: 'oblique' // 斜截面
}
```

2. 在 `createSectionPlane()` 中添加处理逻辑
3. 在 `CrossSectionPanel.vue` 中添加选项

### 添加新的控制功能

1. 在 `CrossSectionPanel.vue` 中添加 UI 控件
2. 在 `sceneStore` 中添加状态和方法
3. 在 `CrossSectionController.vue` 中监听状态变化

### 自定义截面效果

可以修改 `applySectionToModel()` 函数，添加自定义的截面效果：

```javascript
export function applySectionToModel(model, plane) {
  // 添加自定义逻辑
  // 例如：截面边缘高亮、截面纹理等
}
```

## 性能优化建议

1. **按需更新**：截面位置变化时，只在必要时更新
2. **防抖处理**：滑块拖动时使用防抖，减少更新频率
3. **LOD 优化**：三视图模式使用较低精度的模型
4. **缓存场景**：三视图的场景可以缓存，避免重复克隆

## 注意事项

1. 模型需要支持 ClippingPlanes（Three.js 材质属性）
2. 截面效果只在支持 WebGL 的浏览器中生效
3. 三视图模式会创建场景副本，注意内存使用
4. 模型加载失败时会创建占位几何体用于测试

## 测试建议

1. 测试不同截面类型的切换
2. 测试截面位置的实时调整
3. 测试扫描动画的播放和停止
4. 测试三视图模式的开启和关闭
5. 测试多个模型同时应用截面

## 后续优化方向

1. 支持多平面截面（同时显示多个截面）
2. 支持截面厚度可视化
3. 支持截面数据导出（保存截面图像）
4. 支持截面测量（测量截面内结构尺寸）
5. 支持真实 CT/MRI 数据集成

